<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"  lang="en-us">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<title>Error handling with Either | jherrlin</title>

<meta property='og:title' content='Error handling with Either - jherrlin'>
<meta property='og:description' content='TLDR Either is either Left or Right with values inside. Either is a union type. It&#39;s a concept that is language agnostic. It&#39;s right biased. Left is used to transport/represent errors. Right is used to transport/represent the successful data. =flatMap= and =map= are used to chain them together. bind is sugar over =flatMap= and =map= to make the code more sequential and easier to read. It short circuits if it gets a Left.'>
<meta property='og:url' content='https://jherrlin.github.io/posts/error-handling-with-either/'>
<meta property='og:site_name' content='jherrlin'>
<meta property='og:type' content='article'><meta property='og:image' content='https://www.gravatar.com/avatar/4bc4e51875ff5d86326b676d50864a2c?s=256'><meta property='article:section' content='Posts'><meta property='article:tag' content='programming'><meta property='article:tag' content='fp'><meta property='article:tag' content='either'><meta property='article:tag' content='types'><meta property='article:tag' content='errorhandling'><meta property='article:tag' content='uniontype'><meta property='article:published_time' content='2023-02-20T16:00:00&#43;02:00'/><meta property='article:modified_time' content='2023-02-20T16:00:00&#43;02:00'/><meta name='twitter:card' content='summary'><meta name='twitter:site' content='@jherrlin'><meta name='twitter:creator' content='@jherrlin'>


<link href="https://jherrlin.github.io/index.xml" rel="alternate" type="application/rss+xml" title="jherrlin" />

<link rel="stylesheet" href="/css/style.css"/><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<link rel="canonical" href="https://jherrlin.github.io/posts/error-handling-with-either/">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
</head>
<body>
<section class="section">
  <div class="container">
    <nav id="nav-main" class="nav">
      <div id="nav-name" class="nav-left">
        <a id="nav-anchor" class="nav-item" href="https://jherrlin.github.io/">
          <h1 id="nav-heading" class="title is-4">jherrlin</h1>
        </a>
      </div>
      <div class="nav-right">
        <nav id="nav-items" class="nav-item level is-mobile"><a class="level-item" aria-label="github" href='https://github.com/jherrlin'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="twitter" href='https://twitter.com/jherrlin'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="email" href='mailto:jherrlin@gmail.com'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
    <polyline points="22,6 12,13 2,6"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="linkedin" href='https://linkedin.com/in/john-herrlin-63458280'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path stroke-width="1.8" d="m5.839218,4.101561c0,1.211972 -0.974141,2.194011 -2.176459,2.194011s-2.176459,-0.982039 -2.176459,-2.194011c0,-1.211094 0.974141,-2.194011 2.176459,-2.194011s2.176459,0.982917 2.176459,2.194011zm0.017552,3.94922l-4.388022,0l0,14.04167l4.388022,0l0,-14.04167zm7.005038,0l-4.359939,0l0,14.04167l4.360816,0l0,-7.370999c0,-4.098413 5.291077,-4.433657 5.291077,0l0,7.370999l4.377491,0l0,-8.89101c0,-6.915523 -7.829986,-6.66365 -9.669445,-3.259423l0,-1.891237z"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="rss" href='/index.xml'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle>
    
  </svg></i>
            </span>
          </a></nav>
      </div>
    </nav>

    <nav class="nav">
      

      
    </nav>

  </div>
  <script src="/js/navicon-shift.js"></script>
</section>
<section class="section">
  <div class="container">
    <div class="subtitle tags is-6 is-pulled-right">
      
      
<a class="subtitle is-6" href="/tags/programming/">#programming</a>



  
  | <a class="subtitle is-6" href="/tags/fp/">#fp</a>
  
  | <a class="subtitle is-6" href="/tags/either/">#either</a>
  
  | <a class="subtitle is-6" href="/tags/types/">#types</a>
  
  | <a class="subtitle is-6" href="/tags/errorhandling/">#errorhandling</a>
  
  | <a class="subtitle is-6" href="/tags/uniontype/">#uniontype</a>
  


      
    </div>
    <h2 class="subtitle is-6">February 20, 2023</h2>
    <h1 class="title">Error handling with Either</h1>
    
    <div class="content">
      
<div id="outline-container-headline-1" class="outline-2">
<h2 id="headline-1">
TLDR
</h2>
<div id="outline-text-headline-1" class="outline-text-2">
<div class="src src-text">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">  Either is either Left or Right with values inside.
</span></span><span class="line"><span class="cl">  Either is a union type.
</span></span><span class="line"><span class="cl">  It&#39;s a concept that is language agnostic.
</span></span><span class="line"><span class="cl">  It&#39;s right biased.
</span></span><span class="line"><span class="cl">  Left is used to transport/represent errors.
</span></span><span class="line"><span class="cl">  Right is used to transport/represent the successful data.
</span></span><span class="line"><span class="cl">  =flatMap= and =map= are used to chain them together.
</span></span><span class="line"><span class="cl">  bind is sugar over =flatMap= and =map= to make the code more sequential and easier to read.
</span></span><span class="line"><span class="cl">  It short circuits if it gets a Left.
</span></span><span class="line"><span class="cl">  Vavr for Java (no bind here).
</span></span><span class="line"><span class="cl">  Arrow for Kotlin (here you have bind).</span></span></code></pre></div>
</div>
</div>
</div>
<div id="outline-container-headline-2" class="outline-2">
<h2 id="headline-2">
Introduction
</h2>
<div id="outline-text-headline-2" class="outline-text-2">
<p>
  Errors and exceptions in applications can be hard to handle and be aware of.
  Java tries to solve this with <a href="https://kotlinlang.org/docs/exceptions.html#checked-exceptions">checked exceptions</a>. Kotlin doesn&#39;t have checked
  exceptions so the compiler won&#39;t help or guide you.</p>
<p>
  One way of solving this is to represent errors and exceptions in a union type.
  There are a couple of different data types, one is Kotlin&#39;s built in <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-result/">Result</a>.
  <code class="verbatim">Result</code> is a union type that can be of type A or Throwable. <code class="verbatim">Either</code> is a bit
  more general than <code class="verbatim">Result</code> and have <code class="verbatim">Left&lt;A&gt;</code> and <code class="verbatim">Right&lt;B&gt;</code>. <code class="verbatim">Left</code> and
  <code class="verbatim">Right</code> can contain any data type. By convention is <code class="verbatim">Left</code> used for error.</p>
<p>
  When a function returns a union type like <code class="verbatim">Either</code>. The compiler will make you
  aware of it and can guide you to handle both of the cases, <code class="verbatim">Left</code> and <code class="verbatim">Right</code>.</p>
</div>
</div>
<div id="outline-container-headline-3" class="outline-2">
<h2 id="headline-3">
Exceptions
</h2>
<div id="outline-text-headline-3" class="outline-text-2">
<p>
  Here is a small application that does 4 calculations. Each calculation is
  simulated to be executed on a different server, so the request could fail and
  throw an error.</p>
<p>
  This is pretty standard approach and often seen. In this case it&#39;s a small
  example so we can easily handle the exception. But if you forget the try/catch
  here you could end up in problem. Exceptions bring with them non-local jumps,
  which can make it hard to understand the flow of our code if you don&#39;t catch
  them locally.</p>
<div class="src src-kotlin">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl">  <span class="k">import</span> <span class="nn">java.io.IOException</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// Simulates an external call to server
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">fun</span> <span class="p">&lt;</span><span class="nc">A</span><span class="p">&gt;</span> <span class="nf">runOnServer</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="n">A</span><span class="p">):</span> <span class="n">A</span> <span class="p">=</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="nc">Math</span><span class="p">.</span><span class="n">random</span><span class="p">()</span> <span class="p">&gt;</span> <span class="m">0.2</span><span class="p">)</span> <span class="n">f</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="k">else</span> <span class="k">throw</span> <span class="n">IOException</span><span class="p">(</span><span class="s2">&#34;boom!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">fun</span> <span class="nf">addition</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">Int</span><span class="p">):</span> <span class="n">Int</span> <span class="p">=</span> <span class="n">runOnServer</span> <span class="p">{</span> <span class="n">a</span> <span class="p">+</span> <span class="n">b</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">fun</span> <span class="nf">subtraction</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">Int</span><span class="p">):</span> <span class="n">Int</span> <span class="p">=</span> <span class="n">runOnServer</span> <span class="p">{</span> <span class="n">a</span> <span class="p">-</span> <span class="n">b</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">fun</span> <span class="nf">multiplication</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">Int</span><span class="p">):</span> <span class="n">Int</span> <span class="p">=</span> <span class="n">runOnServer</span> <span class="p">{</span> <span class="n">a</span> <span class="p">*</span> <span class="n">b</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">fun</span> <span class="nf">division</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">Int</span><span class="p">):</span> <span class="n">Int</span> <span class="p">=</span> <span class="n">runOnServer</span> <span class="p">{</span> <span class="n">a</span> <span class="p">/</span> <span class="n">b</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">fun</span> <span class="nf">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">      <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="k">val</span> <span class="py">additionResult</span> <span class="p">=</span> <span class="n">addition</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="k">val</span> <span class="py">subtractionResult</span> <span class="p">=</span> <span class="n">subtraction</span><span class="p">(</span><span class="n">additionResult</span><span class="p">,</span> <span class="m">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="k">val</span> <span class="py">multiplicationResult</span> <span class="p">=</span> <span class="n">multiplication</span><span class="p">(</span><span class="n">subtractionResult</span><span class="p">,</span> <span class="m">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="k">val</span> <span class="py">divisionResult</span> <span class="p">=</span> <span class="n">division</span><span class="p">(</span><span class="n">multiplicationResult</span><span class="p">,</span> <span class="m">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="n">println</span><span class="p">(</span><span class="n">divisionResult</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="n">Exception</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="n">println</span><span class="p">(</span><span class="s2">&#34;Error: </span><span class="si">${e.message}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span></span></span></code></pre></div>
</div>
<div class="src src-result">
<pre tabindex="0"><code class="language-result" data-lang="result">Error: boom!</code></pre>
</div>
<p>
  A function name could imply that it could throw an exception. For example
  <code class="verbatim">getPlayer(playerId)</code> hints that it will make I/O. But to be sure you need to
  look inside. This could be a disturbance and harms the purpose of an
  abstraction.</p>
<p>
  By only looking at the function names in this example it&#39;s easy to reason that
  only <code class="verbatim">division</code> could throw an <code class="verbatim">ArithmeticException</code>. But you need to look in
  the definitions to be sure.</p>
<p>
  If the functions in this example instead returned <code class="verbatim">Either&lt;Error, Int&gt;</code> it
  would be very clear that an error could occur.</p>
</div>
</div>
<div id="outline-container-headline-4" class="outline-2">
<h2 id="headline-4">
Railway programming
</h2>
<div id="outline-text-headline-4" class="outline-text-2">
<p>
  For this union types there are very general patterns and we can create simple
  functions that chain the functions together and short circuits if an error
  occurs. This is sometimes refereed to as railway programming.</p>
<p>
  In this railroad track you have 3 steps that needs to be executed in sequence.
  Each one of them can fail and if so it will short circuits and exit. So if
  Validate fails, UpdateDB and SendEmail won&#39;t be executed. But if Validate
  succeeds, it will go on to UpdateDb.</p>
<p>
  <img src="/railway-programming.png" alt="/railway-programming.png" title="/railway-programming.png" /></p>
<p>
  We arrive at Validate. If we get an <code class="verbatim">Either.Right</code> we continue to UpdateDB. If
  we get an <code class="verbatim">Either.Left</code> we short circuit and exit.</p>
<p>
  <img src="/railway-programming-2.png" alt="/railway-programming-2.png" title="/railway-programming-2.png" /></p>
</div>
</div>
<div id="outline-container-headline-5" class="outline-2">
<h2 id="headline-5">
flatMap, map and fold
</h2>
<div id="outline-text-headline-5" class="outline-text-2">
<p>
  There are 3 essential functions when working with railway programming and
  <code class="verbatim">Either</code>; <code class="verbatim">flatMap</code>, <code class="verbatim">map</code> and <code class="verbatim">fold</code>. Let&#39;s look at the implementations, they
  are super simple and you will see them or slight variations in different
  implementations of <code class="verbatim">Either</code>.</p>
<div id="outline-container-headline-6" class="outline-3">
<h3 id="headline-6">
flatMap
</h3>
<div id="outline-text-headline-6" class="outline-text-3">
<p>
   If we get an <code class="verbatim">Either.Right</code> we unpack the value and apply function <code class="verbatim">f</code> to it.
   If we get an <code class="verbatim">Either.Left</code> we should just pass it on. This is the short
   circuit mechanism. Just like in the railroad diagrams.</p>
<div class="src src-kotlin">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl">  <span class="k">public</span> <span class="k">inline</span> <span class="k">fun</span> <span class="p">&lt;</span><span class="nc">A</span><span class="p">,</span> <span class="nc">B</span><span class="p">,</span> <span class="nc">C</span><span class="p">&gt;</span> <span class="nf">Either</span><span class="p">&lt;</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">&gt;.</span><span class="n">flatMap</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="p">(</span><span class="n">B</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Either</span><span class="p">&lt;</span><span class="n">A</span><span class="p">,</span> <span class="n">C</span><span class="p">&gt;):</span> <span class="n">Either</span><span class="p">&lt;</span><span class="n">A</span><span class="p">,</span> <span class="n">C</span><span class="p">&gt;</span> <span class="p">=</span>
</span></span><span class="line"><span class="cl">      <span class="k">when</span> <span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="k">is</span> <span class="n">Right</span> <span class="o">-&gt;</span> <span class="n">f</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="k">value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="k">is</span> <span class="n">Left</span> <span class="o">-&gt;</span> <span class="k">this</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span></span></span></code></pre></div>
</div>
</div>
</div>
<div id="outline-container-headline-7" class="outline-3">
<h3 id="headline-7">
map
</h3>
<div id="outline-text-headline-7" class="outline-text-3">
<p>
   Is defined in terms of <code class="verbatim">flatMap</code> and only wraps the return from <code class="verbatim">flatMap</code> in
   an <code class="verbatim">Either.Right</code>.</p>
<div class="src src-kotlin">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl">  <span class="k">public</span> <span class="k">inline</span> <span class="k">fun</span> <span class="p">&lt;</span><span class="nc">C</span><span class="p">&gt;</span> <span class="nf">map</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="p">(</span><span class="n">B</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">C</span><span class="p">):</span> <span class="n">Either</span><span class="p">&lt;</span><span class="n">A</span><span class="p">,</span> <span class="n">C</span><span class="p">&gt;</span> <span class="p">=</span>
</span></span><span class="line"><span class="cl">      <span class="n">flatMap</span> <span class="p">{</span> <span class="n">Right</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="k">it</span><span class="p">))</span> <span class="p">}</span></span></span></code></pre></div>
</div>
</div>
</div>
<div id="outline-container-headline-8" class="outline-3">
<h3 id="headline-8">
fold
</h3>
<div id="outline-text-headline-8" class="outline-text-3">
<p>
   If we get a <code class="verbatim">Either.Right</code>, run <code class="verbatim">ifRight</code> on its value, if we get an
   <code class="verbatim">Either.Left</code>, run <code class="verbatim">ifLeft</code> on its value. You don&#39;t need to end a chain with
   <code class="verbatim">fold</code>, there are a lot of other operators depending on the use case.</p>
<div class="src src-kotlin">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl">  <span class="k">public</span> <span class="k">inline</span> <span class="k">fun</span> <span class="p">&lt;</span><span class="nc">C</span><span class="p">&gt;</span> <span class="nf">fold</span><span class="p">(</span><span class="n">ifLeft</span><span class="p">:</span> <span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">C</span><span class="p">,</span> <span class="n">ifRight</span><span class="p">:</span> <span class="p">(</span><span class="n">B</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">C</span><span class="p">):</span> <span class="n">C</span> <span class="p">=</span>
</span></span><span class="line"><span class="cl">      <span class="k">when</span> <span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="k">is</span> <span class="n">Right</span> <span class="o">-&gt;</span> <span class="n">ifRight</span><span class="p">(</span><span class="k">value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="k">is</span> <span class="n">Left</span> <span class="o">-&gt;</span> <span class="n">ifLeft</span><span class="p">(</span><span class="k">value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span></span></span></code></pre></div>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-9" class="outline-2">
<h2 id="headline-9">
<a href="https://www.javadoc.io/doc/io.vavr/vavr/0.10.0/io/vavr/control/Either.html">Either</a> in <a href="https://www.vavr.io/">Vavr</a>
</h2>
<div id="outline-text-headline-9" class="outline-text-2">
<p>
  Let&#39;s put it all together.</p>
<p>
  We have the same 4 calculations, but we also have a <code class="verbatim">trap</code> function and an
  <code class="verbatim">Error</code> data class. Each calculation is surrounded in <code class="verbatim">trap</code>, so if
  <code class="verbatim">runOnServer</code> throws an exception the exception will be captured in the
  <code class="verbatim">Error</code> object together with a string and contained in a <code class="verbatim">Either.Left</code>. If
  everything is successful we get the calculated value in a <code class="verbatim">Either.Right</code>.</p>
<div class="src src-kotlin">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl">  <span class="k">import</span> <span class="nn">io.vavr.control.Either</span>
</span></span><span class="line"><span class="cl">  <span class="k">import</span> <span class="nn">java.io.IOException</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// A data class that holds data about the error
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">data</span> <span class="k">class</span> <span class="nc">Error</span><span class="p">(</span><span class="k">val</span> <span class="py">errorString</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span> <span class="k">val</span> <span class="py">exception</span><span class="p">:</span> <span class="n">Exception</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// Simulates an operation that can go wrong
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">fun</span> <span class="p">&lt;</span><span class="nc">A</span><span class="p">&gt;</span> <span class="nf">runOnServer</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="n">A</span><span class="p">):</span> <span class="n">A</span> <span class="p">=</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="nc">Math</span><span class="p">.</span><span class="n">random</span><span class="p">()</span> <span class="p">&gt;</span> <span class="m">0.2</span><span class="p">)</span> <span class="n">f</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="k">else</span> <span class="k">throw</span> <span class="n">IOException</span><span class="p">(</span><span class="s2">&#34;boom!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// Wrap in Either.Left if exception, else in Either.Right
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">fun</span> <span class="p">&lt;</span><span class="nc">A</span><span class="p">&gt;</span> <span class="nf">trap</span><span class="p">(</span><span class="n">errorString</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="n">A</span><span class="p">):</span> <span class="n">Either</span><span class="p">&lt;</span><span class="n">Error</span><span class="p">,</span> <span class="n">A</span><span class="p">&gt;</span> <span class="p">=</span>
</span></span><span class="line"><span class="cl">      <span class="k">try</span> <span class="p">{</span> <span class="nc">Either</span><span class="p">.</span><span class="n">right</span><span class="p">(</span><span class="n">f</span><span class="p">())</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="n">Exception</span><span class="p">)</span> <span class="p">{</span> <span class="nc">Either</span><span class="p">.</span><span class="n">left</span><span class="p">(</span><span class="n">Error</span><span class="p">(</span><span class="n">errorString</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">fun</span> <span class="nf">addition</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">Int</span><span class="p">):</span> <span class="n">Either</span><span class="p">&lt;</span><span class="n">Error</span><span class="p">,</span> <span class="n">Int</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">trap</span><span class="p">(</span><span class="s2">&#34;Addition failed&#34;</span><span class="p">)</span> <span class="p">{</span> <span class="n">runOnServer</span> <span class="p">{</span> <span class="n">a</span> <span class="p">+</span> <span class="n">b</span> <span class="p">}</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">fun</span> <span class="nf">subtraction</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">Int</span><span class="p">):</span> <span class="n">Either</span><span class="p">&lt;</span><span class="n">Error</span><span class="p">,</span> <span class="n">Int</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">trap</span><span class="p">(</span><span class="s2">&#34;Subtraction failed&#34;</span><span class="p">)</span> <span class="p">{</span> <span class="n">runOnServer</span> <span class="p">{</span> <span class="n">a</span> <span class="p">-</span> <span class="n">b</span> <span class="p">}</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">fun</span> <span class="nf">multiplication</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">Int</span><span class="p">):</span> <span class="n">Either</span><span class="p">&lt;</span><span class="n">Error</span><span class="p">,</span> <span class="n">Int</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">trap</span><span class="p">(</span><span class="s2">&#34;Multiplication failed&#34;</span><span class="p">)</span> <span class="p">{</span> <span class="n">runOnServer</span> <span class="p">{</span> <span class="n">a</span> <span class="p">*</span> <span class="n">b</span> <span class="p">}</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">fun</span> <span class="nf">division</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">Int</span><span class="p">):</span> <span class="n">Either</span><span class="p">&lt;</span><span class="n">Error</span><span class="p">,</span> <span class="n">Int</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">trap</span><span class="p">(</span><span class="s2">&#34;Division failed&#34;</span><span class="p">)</span> <span class="p">{</span> <span class="n">runOnServer</span> <span class="p">{</span> <span class="n">a</span> <span class="p">/</span> <span class="n">b</span> <span class="p">}</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">addition</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">.</span><span class="n">flatMap</span> <span class="p">{</span> <span class="n">additionResult</span> <span class="o">-&gt;</span>
</span></span><span class="line"><span class="cl">              <span class="n">subtraction</span><span class="p">(</span><span class="n">additionResult</span><span class="p">,</span> <span class="m">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                  <span class="p">.</span><span class="n">flatMap</span> <span class="p">{</span> <span class="n">subtractionResult</span> <span class="o">-&gt;</span>
</span></span><span class="line"><span class="cl">                      <span class="n">multiplication</span><span class="p">(</span><span class="n">subtractionResult</span><span class="p">,</span> <span class="m">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                          <span class="p">.</span><span class="n">flatMap</span> <span class="p">{</span> <span class="n">multiplicationResult</span> <span class="o">-&gt;</span>
</span></span><span class="line"><span class="cl">                              <span class="n">division</span><span class="p">(</span><span class="n">multiplicationResult</span><span class="p">,</span> <span class="m">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                                  <span class="p">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">divisionResult</span> <span class="o">-&gt;</span>
</span></span><span class="line"><span class="cl">                                      <span class="n">divisionResult</span>
</span></span><span class="line"><span class="cl">                                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">                          <span class="p">}</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="p">.</span><span class="n">fold</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">              <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="c1">// This is what we do if we get an Either.Left / Error
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                  <span class="n">println</span><span class="p">(</span><span class="k">it</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">              <span class="p">},</span>
</span></span><span class="line"><span class="cl">              <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="c1">// This is what we do if we get an Either.Right
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                  <span class="n">println</span><span class="p">(</span><span class="k">it</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">              <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span></span></span></code></pre></div>
</div>
<div class="src src-result">
<pre tabindex="0"><code class="language-result" data-lang="result">Error(errorString=Division failed, exception=java.io.IOException: boom!)</code></pre>
</div>
<p>
  The code could be represented in a railway diagram. If <code class="verbatim">addition</code> returns a
  <code class="verbatim">Right&lt;Int&gt;</code> we continue to <code class="verbatim">subtraction</code> with the value inside <code class="verbatim">Right&lt;Int&gt;</code>,
  if <code class="verbatim">addition</code> fails it circuit breaks and returns a <code class="verbatim">Left&lt;Error&gt;</code> containing
  the error. It follow the same pattern all the way down. And returns a
  <code class="verbatim">Right&lt;Int&gt;</code> or a <code class="verbatim">Left&lt;Error&gt;</code>.</p>
<p>
  <img src="/either-railway.drawio.png" alt="/either-railway.drawio.png" title="/either-railway.drawio.png" /></p>
</div>
</div>
<div id="outline-container-headline-10" class="outline-2">
<h2 id="headline-10">
<a href="https://arrow-kt.io/docs/apidocs/arrow-core/arrow.core/-either/">Either</a> in Arrow
</h2>
<div id="outline-text-headline-10" class="outline-text-2">
<p>
  <a href="https://www.vavr.io/">Vavr</a> is aimed for Java and there is another implementation of <a href="https://arrow-kt.io/docs/apidocs/arrow-core/arrow.core/-either/">Either</a> aim for
  Kotlin in a lib called <a href="https://arrow-kt.io/">Arrow</a>.</p>
<p>
  Here we replace the <code class="verbatim">Either</code> implementation from Vavr to Arrow. The code looks
  more or less the same. It&#39;s the same pattern with <code class="verbatim">flatMap</code>, <code class="verbatim">map</code> and <code class="verbatim">fold</code>.</p>
<div class="src src-kotlin">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl">  <span class="k">import</span> <span class="nn">arrow.core.Either</span>
</span></span><span class="line"><span class="cl">  <span class="k">import</span> <span class="nn">arrow.core.flatMap</span>
</span></span><span class="line"><span class="cl">  <span class="k">import</span> <span class="nn">java.io.IOException</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// A data class that holds data about the error
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">data</span> <span class="k">class</span> <span class="nc">Error</span><span class="p">(</span><span class="k">val</span> <span class="py">errorString</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span> <span class="k">val</span> <span class="py">exception</span><span class="p">:</span> <span class="n">Exception</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// Simulates an operation that can go wrong
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">fun</span> <span class="p">&lt;</span><span class="nc">A</span><span class="p">&gt;</span> <span class="nf">runOnServer</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="n">A</span><span class="p">):</span> <span class="n">A</span> <span class="p">=</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="nc">Math</span><span class="p">.</span><span class="n">random</span><span class="p">()</span> <span class="p">&gt;</span> <span class="m">0.2</span><span class="p">)</span> <span class="n">f</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="k">else</span> <span class="k">throw</span> <span class="n">IOException</span><span class="p">(</span><span class="s2">&#34;boom!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// Wrap in Either.Left if exception, else in Either.Right
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">fun</span> <span class="p">&lt;</span><span class="nc">A</span><span class="p">&gt;</span> <span class="nf">trap</span><span class="p">(</span><span class="n">errorString</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="n">A</span><span class="p">):</span> <span class="n">Either</span><span class="p">&lt;</span><span class="n">Error</span><span class="p">,</span> <span class="n">A</span><span class="p">&gt;</span> <span class="p">=</span>
</span></span><span class="line"><span class="cl">      <span class="k">try</span> <span class="p">{</span> <span class="nc">Either</span><span class="p">.</span><span class="n">Right</span><span class="p">(</span><span class="n">f</span><span class="p">())</span> <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="n">Exception</span><span class="p">)</span> <span class="p">{</span> <span class="nc">Either</span><span class="p">.</span><span class="n">Left</span><span class="p">(</span><span class="n">Error</span><span class="p">(</span><span class="n">errorString</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">fun</span> <span class="nf">addition</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">Int</span><span class="p">):</span> <span class="n">Either</span><span class="p">&lt;</span><span class="n">Error</span><span class="p">,</span> <span class="n">Int</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">trap</span><span class="p">(</span><span class="s2">&#34;Addition failed&#34;</span><span class="p">)</span> <span class="p">{</span> <span class="n">runOnServer</span> <span class="p">{</span> <span class="n">a</span> <span class="p">+</span> <span class="n">b</span> <span class="p">}</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">fun</span> <span class="nf">subtraction</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">Int</span><span class="p">):</span> <span class="n">Either</span><span class="p">&lt;</span><span class="n">Error</span><span class="p">,</span> <span class="n">Int</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">trap</span><span class="p">(</span><span class="s2">&#34;Subtraction failed&#34;</span><span class="p">)</span> <span class="p">{</span> <span class="n">runOnServer</span> <span class="p">{</span> <span class="n">a</span> <span class="p">-</span> <span class="n">b</span> <span class="p">}</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">fun</span> <span class="nf">multiplication</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">Int</span><span class="p">):</span> <span class="n">Either</span><span class="p">&lt;</span><span class="n">Error</span><span class="p">,</span> <span class="n">Int</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">trap</span><span class="p">(</span><span class="s2">&#34;Multiplication failed&#34;</span><span class="p">)</span> <span class="p">{</span> <span class="n">runOnServer</span> <span class="p">{</span> <span class="n">a</span> <span class="p">*</span> <span class="n">b</span> <span class="p">}</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">fun</span> <span class="nf">division</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">Int</span><span class="p">):</span> <span class="n">Either</span><span class="p">&lt;</span><span class="n">Error</span><span class="p">,</span> <span class="n">Int</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">trap</span><span class="p">(</span><span class="s2">&#34;Division failed&#34;</span><span class="p">)</span> <span class="p">{</span> <span class="n">runOnServer</span> <span class="p">{</span> <span class="n">a</span> <span class="p">/</span> <span class="n">b</span> <span class="p">}</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">addition</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">.</span><span class="n">flatMap</span> <span class="p">{</span> <span class="n">additionResult</span> <span class="o">-&gt;</span>
</span></span><span class="line"><span class="cl">              <span class="n">subtraction</span><span class="p">(</span><span class="n">additionResult</span><span class="p">,</span> <span class="m">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                  <span class="p">.</span><span class="n">flatMap</span> <span class="p">{</span> <span class="n">subtractionResult</span> <span class="o">-&gt;</span>
</span></span><span class="line"><span class="cl">                      <span class="n">multiplication</span><span class="p">(</span><span class="n">subtractionResult</span><span class="p">,</span> <span class="m">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                          <span class="p">.</span><span class="n">flatMap</span> <span class="p">{</span> <span class="n">multiplicationResult</span> <span class="o">-&gt;</span>
</span></span><span class="line"><span class="cl">                              <span class="n">division</span><span class="p">(</span><span class="n">multiplicationResult</span><span class="p">,</span> <span class="m">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                                  <span class="p">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">divisionResult</span> <span class="o">-&gt;</span>
</span></span><span class="line"><span class="cl">                                      <span class="n">divisionResult</span>
</span></span><span class="line"><span class="cl">                                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">                          <span class="p">}</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="p">.</span><span class="n">fold</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">              <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="c1">// This is what we should do if we get an Either.Left / Error
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                  <span class="n">println</span><span class="p">(</span><span class="k">it</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">              <span class="p">},</span>
</span></span><span class="line"><span class="cl">              <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="c1">// This is what we do if everything when well
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                  <span class="n">println</span><span class="p">(</span><span class="k">it</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">              <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span></span></span></code></pre></div>
</div>
<div class="src src-result">
<pre tabindex="0"><code class="language-result" data-lang="result">Error(errorString=Addition failed, exception=java.io.IOException: boom!)</code></pre>
</div>
<p>
  We still have the <code class="verbatim">flatMap</code>, <code class="verbatim">map</code> pyramid. Let&#39;s see if we can do something
  about it.</p>
</div>
</div>
<div id="outline-container-headline-11" class="outline-2">
<h2 id="headline-11">
Bind in Arrow
</h2>
<div id="outline-text-headline-11" class="outline-text-2">
<p>
  So let&#39;s look at how Arrow can fix this for us with something called <code class="verbatim">bind</code>.
  This gives us the exact same pattern as in the examples above, but it looks
  much more sequential and is much easier to read. The <code class="verbatim">either&lt;Error,Int&gt;</code>
  returns an <code class="verbatim">Either</code> and we fold over the result to take action on both the
  <code class="verbatim">Either.Left</code> and <code class="verbatim">Either.Right</code>.</p>
<div class="src src-kotlin">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">import</span> <span class="nn">arrow.core.Either</span>
</span></span><span class="line"><span class="cl"><span class="k">import</span> <span class="nn">arrow.core.continuations.either</span>
</span></span><span class="line"><span class="cl"><span class="k">import</span> <span class="nn">kotlinx.coroutines.runBlocking</span>
</span></span><span class="line"><span class="cl"><span class="k">import</span> <span class="nn">java.io.IOException</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// A data class that holds data about the error
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">data</span> <span class="k">class</span> <span class="nc">Error</span><span class="p">(</span><span class="k">val</span> <span class="py">errorString</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span> <span class="k">val</span> <span class="py">exception</span><span class="p">:</span> <span class="n">Exception</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Simulates an operation that can go wrong
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">fun</span> <span class="p">&lt;</span><span class="nc">A</span><span class="p">&gt;</span> <span class="nf">runOnServer</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="n">A</span><span class="p">):</span> <span class="n">A</span> <span class="p">=</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nc">Math</span><span class="p">.</span><span class="n">random</span><span class="p">()</span> <span class="p">&gt;</span> <span class="m">0.2</span><span class="p">)</span> <span class="n">f</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span> <span class="k">throw</span> <span class="n">IOException</span><span class="p">(</span><span class="s2">&#34;boom!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Wrap in Either.Left if exception, else in Either.Right
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">fun</span> <span class="p">&lt;</span><span class="nc">A</span><span class="p">&gt;</span> <span class="nf">trap</span><span class="p">(</span><span class="n">errorString</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="n">A</span><span class="p">):</span> <span class="n">Either</span><span class="p">&lt;</span><span class="n">Error</span><span class="p">,</span> <span class="n">A</span><span class="p">&gt;</span> <span class="p">=</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="p">{</span> <span class="nc">Either</span><span class="p">.</span><span class="n">Right</span><span class="p">(</span><span class="n">f</span><span class="p">())</span> <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="n">Exception</span><span class="p">)</span> <span class="p">{</span> <span class="nc">Either</span><span class="p">.</span><span class="n">Left</span><span class="p">(</span><span class="n">Error</span><span class="p">(</span><span class="n">errorString</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">fun</span> <span class="nf">addition</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">Int</span><span class="p">):</span> <span class="n">Either</span><span class="p">&lt;</span><span class="n">Error</span><span class="p">,</span> <span class="n">Int</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">trap</span><span class="p">(</span><span class="s2">&#34;Addition failed&#34;</span><span class="p">)</span> <span class="p">{</span> <span class="n">runOnServer</span> <span class="p">{</span> <span class="n">a</span> <span class="p">+</span> <span class="n">b</span> <span class="p">}</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">fun</span> <span class="nf">subtraction</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">Int</span><span class="p">):</span> <span class="n">Either</span><span class="p">&lt;</span><span class="n">Error</span><span class="p">,</span> <span class="n">Int</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">trap</span><span class="p">(</span><span class="s2">&#34;Subtraction failed&#34;</span><span class="p">)</span> <span class="p">{</span> <span class="n">runOnServer</span> <span class="p">{</span> <span class="n">a</span> <span class="p">-</span> <span class="n">b</span> <span class="p">}</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">fun</span> <span class="nf">multiplication</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">Int</span><span class="p">):</span> <span class="n">Either</span><span class="p">&lt;</span><span class="n">Error</span><span class="p">,</span> <span class="n">Int</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">trap</span><span class="p">(</span><span class="s2">&#34;Multiplication failed&#34;</span><span class="p">)</span> <span class="p">{</span> <span class="n">runOnServer</span> <span class="p">{</span> <span class="n">a</span> <span class="p">*</span> <span class="n">b</span> <span class="p">}</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">fun</span> <span class="nf">division</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">Int</span><span class="p">):</span> <span class="n">Either</span><span class="p">&lt;</span><span class="n">Error</span><span class="p">,</span> <span class="n">Int</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">trap</span><span class="p">(</span><span class="s2">&#34;Division failed&#34;</span><span class="p">)</span> <span class="p">{</span> <span class="n">runOnServer</span> <span class="p">{</span> <span class="n">a</span> <span class="p">/</span> <span class="n">b</span> <span class="p">}</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">runBlocking</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">either</span><span class="p">&lt;</span><span class="n">Error</span><span class="p">,</span><span class="n">Int</span><span class="p">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">val</span> <span class="py">additionResult</span> <span class="p">=</span> <span class="n">addition</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">10</span><span class="p">).</span><span class="n">bind</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="k">val</span> <span class="py">subtractionResult</span> <span class="p">=</span> <span class="n">subtraction</span><span class="p">(</span><span class="n">additionResult</span><span class="p">,</span> <span class="m">10</span><span class="p">).</span><span class="n">bind</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="k">val</span> <span class="py">multiplicationResult</span> <span class="p">=</span> <span class="n">multiplication</span><span class="p">(</span><span class="n">subtractionResult</span><span class="p">,</span> <span class="m">10</span><span class="p">).</span><span class="n">bind</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="k">val</span> <span class="py">divisionResult</span> <span class="p">=</span> <span class="n">division</span><span class="p">(</span><span class="n">multiplicationResult</span><span class="p">,</span> <span class="m">10</span><span class="p">).</span><span class="n">bind</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="n">divisionResult</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}.</span><span class="n">fold</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// This is what we should do if we get an Either.Left / Error
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">println</span><span class="p">(</span><span class="k">it</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// This is what we do if everything when well
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">println</span><span class="p">(</span><span class="k">it</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div>
<div class="src src-kotlin">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="m">10</span></span></span></code></pre></div>
</div>
<p>
  The railway diagram for this code is the same as the one above.</p>
<p>
  <img src="/either-railway.drawio.png" alt="/either-railway.drawio.png" title="/either-railway.drawio.png" /></p>
</div>
</div>
<div id="outline-container-headline-12" class="outline-2">
<h2 id="headline-12">
Resources
</h2>
<div id="outline-text-headline-12" class="outline-text-2">
<ul>
<li><a href="https://github.com/Kotlin/KEEP/blob/master/proposals/stdlib/result.md">https://github.com/Kotlin/KEEP/blob/master/proposals/stdlib/result.md</a></li>
<li><a href="https://fsharpforfunandprofit.com/rop/">https://fsharpforfunandprofit.com/rop/</a></li>
<li><a href="https://arrow-kt.io/docs/apidocs/arrow-core/arrow.core/-either/">https://arrow-kt.io/docs/apidocs/arrow-core/arrow.core/-either/</a></li>
<li><a href="https://arrow-kt.io/docs/patterns/monad_comprehensions/">https://arrow-kt.io/docs/patterns/monad_comprehensions/</a></li>
<li><a href="https://www.vavr.io/">https://www.vavr.io/</a></li>
<li><a href="https://www.javadoc.io/doc/io.vavr/vavr/0.10.0/io/vavr/control/Either.html">https://www.javadoc.io/doc/io.vavr/vavr/0.10.0/io/vavr/control/Either.html</a></li>
</ul>
</div>
</div>

      
      <div class="related">

<h3>Similar articles:</h3>
<ul>
	
	<li><a href="/posts/emacs-on-macos-monterey/">Emacs on Macos Monterey</a></li>
	
	<li><a href="/posts/rx-java-with-org-mode/">Learn RxJava with Emacs Org mode</a></li>
	
	<li><a href="/posts/emacs-orgmode-source-code-blocks2/">Emacs Orgmode Source Code Blocks 2</a></li>
	
	<li><a href="/posts/learn-awk/">Learn AWK with Emacs</a></li>
	
	<li><a href="/posts/emacs-orgmode-tables/">Emacs Org mode tables</a></li>
	
</ul>
</div>
      
    </div>
    
  </div>
</section>

    <script src="/js/copycode.js"></script>



<section class="section">
  <div class="container has-text-centered">
    <p></p>
    
      <p>Powered by <a href="https://gohugo.io/">Hugo</a> &amp; <a href="https://github.com/ribice/kiss">Kiss</a>.</p>
    
  </div>
</section>



</body>
</html>

