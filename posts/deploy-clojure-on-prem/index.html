<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"  lang="en-us">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<title> | jherrlin</title>

<meta property='og:title' content=' - jherrlin'>
<meta property='og:description' content='— title: &#34;Deploy Clojure on Prem&#34; date: 2020-07-21T20:39:09&#43;02:00 draft: true —
Intro   This post will be a detailed step by step guide on how to deploy a Clojure project on prem together with a simple continuous delivery process. The major parts of the setup is not specific for Clojure and could be used for other languages as well.
 There is an example Clojure app used in this post, the app is a HTTP REST API that provides person entities generated by Clojure specs via JSON.'>
<meta property='og:url' content='https://jherrlin.github.io/posts/deploy-clojure-on-prem/'>
<meta property='og:site_name' content='jherrlin'>
<meta property='og:type' content='article'><meta property='og:image' content='https://www.gravatar.com/avatar/4bc4e51875ff5d86326b676d50864a2c?s=256'><meta property='article:section' content='Posts'><meta name='twitter:card' content='summary'><meta name='twitter:site' content='@jherrlin'><meta name='twitter:creator' content='@jherrlin'>


<link href="https://jherrlin.github.io/index.xml" rel="alternate" type="application/rss+xml" title="jherrlin" />

<link rel="stylesheet" href="/css/style.css"/><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<link rel="canonical" href="https://jherrlin.github.io/posts/deploy-clojure-on-prem/">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
</head>
<body>
<section class="section">
  <div class="container">
    <nav id="nav-main" class="nav">
      <div id="nav-name" class="nav-left">
        <a id="nav-anchor" class="nav-item" href="https://jherrlin.github.io/">
          <h1 id="nav-heading" class="title is-4">jherrlin</h1>
        </a>
      </div>
      <div class="nav-right">
        <nav id="nav-items" class="nav-item level is-mobile"><a class="level-item" aria-label="github" href='https://github.com/jherrlin'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="twitter" href='https://twitter.com/jherrlin'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="email" href='mailto:jherrlin@gmail.com'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
    <polyline points="22,6 12,13 2,6"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="linkedin" href='https://linkedin.com/in/john-herrlin-63458280'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path stroke-width="1.8" d="m5.839218,4.101561c0,1.211972 -0.974141,2.194011 -2.176459,2.194011s-2.176459,-0.982039 -2.176459,-2.194011c0,-1.211094 0.974141,-2.194011 2.176459,-2.194011s2.176459,0.982917 2.176459,2.194011zm0.017552,3.94922l-4.388022,0l0,14.04167l4.388022,0l0,-14.04167zm7.005038,0l-4.359939,0l0,14.04167l4.360816,0l0,-7.370999c0,-4.098413 5.291077,-4.433657 5.291077,0l0,7.370999l4.377491,0l0,-8.89101c0,-6.915523 -7.829986,-6.66365 -9.669445,-3.259423l0,-1.891237z"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="rss" href='/index.xml'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle>
    
  </svg></i>
            </span>
          </a></nav>
      </div>
    </nav>

    <nav class="nav">
      

      
    </nav>

  </div>
  <script src="/js/navicon-shift.js"></script>
</section>
<section class="section">
  <div class="container">
    <div class="subtitle tags is-6 is-pulled-right">
      
    </div>
    
    <h1 class="title"></h1>
    
    <div class="content">
      
<p>—
title: &#34;Deploy Clojure on Prem&#34;
date: 2020-07-21T20:39:09+02:00
draft: true
—</p>
<div id="outline-container-headline-1" class="outline-2">
<h2 id="headline-1">
Intro
</h2>
<div id="outline-text-headline-1" class="outline-text-2">
<p>
  This post will be a detailed step by step guide on how to deploy a Clojure project on
  prem together with a simple continuous delivery process. The major parts of the setup is
  not specific for Clojure and could be used for other languages as well.</p>
<p>
  There is an example Clojure app used in this post, the app is a HTTP REST API that
  provides person entities generated by Clojure specs via JSON.</p>
<p>
  The big picture is.</p>
<p>
  To make things more repoducable Ansible could be used.</p>
</div>
</div>
<div id="outline-container-headline-2" class="outline-2">
<h2 id="headline-2">
Server setup
</h2>
<div id="outline-text-headline-2" class="outline-text-2">
<div id="outline-container-headline-3" class="outline-3">
<h3 id="headline-3">
<span class="todo">TODO</span>
Debian
</h3>
</div>
<div id="outline-container-headline-4" class="outline-3">
<h3 id="headline-4">
<span class="todo">TODO</span>
SSH Settings
</h3>
</div>
<div id="outline-container-headline-5" class="outline-3">
<h3 id="headline-5">
<span class="todo">TODO</span>
User and groups
</h3>
<div id="outline-text-headline-5" class="outline-text-3">
<div id="outline-container-headline-6" class="outline-4">
<h4 id="headline-6">
<span class="todo">TODO</span>
root
</h4>
</div>
<div id="outline-container-headline-7" class="outline-4">
<h4 id="headline-7">
<span class="todo">TODO</span>
admin
</h4>
</div>
<div id="outline-container-headline-8" class="outline-4">
<h4 id="headline-8">
<span class="todo">TODO</span>
webapps
</h4>
</div>
<div id="outline-container-headline-9" class="outline-4">
<h4 id="headline-9">
<span class="todo">TODO</span>
deploy
</h4>
<div id="outline-text-headline-9" class="outline-text-4">
<p>
    <a href="https://unix.stackexchange.com/questions/14312/how-to-restrict-an-ssh-user-to-only-allow-ssh-tunneling">https://unix.stackexchange.com/questions/14312/how-to-restrict-an-ssh-user-to-only-allow-ssh-tunneling</a></p>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-10" class="outline-3">
<h3 id="headline-10">
<span class="todo">TODO</span>
Java 8 and Clojure
</h3>
</div>
<div id="outline-container-headline-11" class="outline-3">
<h3 id="headline-11">
<span class="todo">TODO</span>
NTP
</h3>
</div>
<div id="outline-container-headline-12" class="outline-3">
<h3 id="headline-12">
<span class="todo">TODO</span>
Nginx
</h3>
</div>
<div id="outline-container-headline-13" class="outline-3">
<h3 id="headline-13">
<span class="todo">TODO</span>
Lets encrypt
</h3>
</div>
<div id="outline-container-headline-14" class="outline-3">
<h3 id="headline-14">
<span class="todo">TODO</span>
Firewall
</h3>
</div>
<div id="outline-container-headline-15" class="outline-3">
<h3 id="headline-15">
<span class="todo">TODO</span>
Unattended secure updates
</h3>
</div>
<div id="outline-container-headline-16" class="outline-3">
<h3 id="headline-16">
<span class="todo">TODO</span>
Systemd services
</h3>
</div>
<div id="outline-container-headline-17" class="outline-3">
<h3 id="headline-17">
<span class="todo">TODO</span>
Alerts via email
</h3>
<div id="outline-text-headline-17" class="outline-text-3">
<p>
   <a href="https://wiki.archlinux.org/index.php/Msmtp">https://wiki.archlinux.org/index.php/Msmtp</a>
   <a href="https://lavaux.lv/2016/12/29/msmtp-mailgun-sengrid.html">https://lavaux.lv/2016/12/29/msmtp-mailgun-sengrid.html</a>
   <a href="https://stackoverflow.com/questions/21830670/start-systemd-service-after-specific-service">https://stackoverflow.com/questions/21830670/start-systemd-service-after-specific-service</a></p>
<div id="outline-container-headline-18" class="outline-4">
<h4 id="headline-18">
msmtp
</h4>
<div id="outline-text-headline-18" class="outline-text-4">
<div id="outline-container-headline-19" class="outline-5">
<h5 id="headline-19">
Sendgrid config
</h5>
<div id="outline-text-headline-19" class="outline-text-5">
<div class="src src-shell">
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">  cat ~/.msmtprc <span class="p">|</span> <span class="se">\
</span><span class="se"></span>      sed -e <span class="s1">&#39;s/^password.*$/password \&lt;YOUR API KEY\&gt;/g&#39;</span> <span class="se">\
</span><span class="se"></span>          -e <span class="s1">&#39;s/^from.*$/from &lt;YOUR EMAIL&gt;/g&#39;</span></code></pre></div>
</div>
<div class="src src-shell">
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># Set default values for all following accounts.</span>
defaults
auth           on
tls            on
tls_trust_file /etc/ssl/certs/ca-certificates.crt
logfile        ~/.msmtp.log

<span class="c1"># Sendgrid</span>
account        sendgrid
host           smtp.sendgrid.net
port           <span class="m">587</span>
from &lt;YOUR EMAIL&gt;
user           apikey
password &lt;YOUR API KEY&gt;

<span class="c1"># Set a default account</span>
account default : sendgrid</code></pre></div>
</div>
</div>
</div>
<div id="outline-container-headline-20" class="outline-5">
<h5 id="headline-20">
Send test mail
</h5>
<div id="outline-text-headline-20" class="outline-text-5">
<div class="src src-shell">
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">  <span class="nb">echo</span> <span class="s2">&#34;hello there.&#34;</span> <span class="p">|</span> msmtp -a sendgrid jherrlin@gmail.com</code></pre></div>
</div>
</div>
</div>
<div id="outline-container-headline-21" class="outline-5">
<h5 id="headline-21">
Systemd service
</h5>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-22" class="outline-2">
<h2 id="headline-22">
Continuous delivery
</h2>
<div id="outline-text-headline-22" class="outline-text-2">
<div id="outline-container-headline-23" class="outline-3">
<h3 id="headline-23">
<span class="todo">TODO</span>
Circle CI
</h3>
</div>
<div id="outline-container-headline-24" class="outline-3">
<h3 id="headline-24">
TODO
</h3>
</div>
</div>
</div>

      
      <div class="related">
</div>
      
    </div>
    
  </div>
</section>

    <script src="/js/copycode.js"></script>



<section class="section">
  <div class="container has-text-centered">
    <p></p>
    
      <p>Powered by <a href="https://gohugo.io/">Hugo</a> &amp; <a href="https://github.com/ribice/kiss">Kiss</a>.</p>
    
  </div>
</section>



</body>
</html>

